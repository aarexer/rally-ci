---

stream:
  module: rallyci.streams.fake
  path: tests/functional/gerrit-sample-stream.json

publishers:
  - module: rallyci.publishers.fancynginx
    dir: /tmp/rally-ci/
    header-filename: .head.html
    header-template: templates/ps.html
    job-template: templates/job.html
    summary-template: templates/summary.html

global:
  recheck-regexp: ^recheck rally$

runners:
  - name: test
    module: rallyci.runners.fake

environments:
  - name: test
    module: rallyci.environments.dummy
    export:
      ONE: one
      TWO: two

scripts:
  - name: test1
    interpreter: /bin/bash -xe -s
    args:
      - change.project
      - patchSet.ref
    data: |
        echo TEST_SCRIPT_1

  - name: test2
    interpreter: /bin/bash -xe -s
    args:
      - change.project
      - patchSet.ref
    path: tests/functional/test_script_2.sh

  - name: pep8
    interpreter: /bin/bash -xe -s
    data: "tox -epep8"

  - name: py27
    interpreter: /bin/bash -xe -s
    data: "tox -epy27"

  - name: cli
    interpreter: /bin/bash -xe -s
    data: "tox -ecli"

projects:
  - name: stackforge/rally
    job-common-attrs:
      build-scripts: ["test1", "test2"]
      runner: test
      runner-args:
        test_arg: 42

    jobs:
      - name: job1
        test-scripts: ["pep8"]

      - name: job2
        test-scripts: ["py27"]

      - name: job3
        environments: ["test"]
        build-scripts: ["test1"]
        test-scripts: ["cli"]
